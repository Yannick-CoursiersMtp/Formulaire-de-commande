<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Commande - Les Coursiers Montpelli√©rains</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha384-OLBgp1GsljhM2TJ+sbHjaiH9txEUvgdDTAzHv2P24donTt6/529l+9Ua0vFImLlb" crossorigin="anonymous">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <header>
    <img src="1000000263.png" alt="Logo Les Coursiers Montpelli√©rains">
    <h1>Formulaire de commande</h1>
  </header>

  <main>
    <form id="orderForm" action="/api/orders" method="POST">
      <input type="text" name="nickname" id="nickname" style="display:none" autocomplete="off">
      <div class="form-section">
        <h2><i class="fas fa-road"></i> D√©tails de la Course</h2>
        <div class="form-grid">
          <div class="input-wrapper full-width">
            <input type="search" id="adresse_depart" name="Adresse de d√©part" placeholder="Adresse de d√©part" required autocomplete="off">
          </div>
          <div class="input-wrapper full-width">
            <input type="search" id="adresse_arrivee" name="Adresse d‚Äôarriv√©e" placeholder="Adresse d‚Äôarriv√©e" required autocomplete="off">
          </div>
          
          <label for="date_recuperation">Date de r√©cup√©ration</label>
          <div class="full-width">
            <input type="date" id="date_recuperation" name="Date de r√©cup√©ration" required>
          </div>
          <label for="heure_debut_recuperation">De</label>
          <label for="heure_fin_recuperation">√Ä</label>
          <input type="time" id="heure_debut_recuperation" name="Heure de d√©but de r√©cup√©ration" required>
          <input type="time" id="heure_fin_recuperation" name="Heure de fin de r√©cup√©ration" required>
          <div id="pickup-time-error" class="error-message full-width">Le cr√©neau de r√©cup√©ration est invalide.</div>

          <label for="date_livraison">Date de livraison</label>
          <div class="full-width">
            <input type="date" id="date_livraison" name="Date de livraison" required>
          </div>
          <label for="heure_debut_livraison">De</label>
          <label for="heure_fin_livraison">√Ä</label>
          <input type="time" id="heure_debut_livraison" name="Heure de d√©but de livraison" required>
          <input type="time" id="heure_fin_livraison" name="Heure de fin de livraison" required>
          <div id="delivery-time-error" class="error-message full-width">Le cr√©neau de livraison est invalide.</div>

          <div class="full-width">
            <p style="font-size: 0.9em; color: #555; margin-top: -0.5rem;">Le tarif est automatiquement ajust√© selon la dur√©e du cr√©neau de r√©cup√©ration.</p>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2><i class="fas fa-box"></i> D√©tails du ou des Colis</h2>
        <div class="form-grid">
            <div class="full-width">
                <label for="parcel_count">Nombre de colis</label>
                <input type="number" id="parcel_count" name="Nombre de colis" value="1" min="1" max="10" required>
            </div>
            <div id="parcels-container" class="full-width"></div>
        </div>
      </div>
      
      <div class="form-section">
        <h2><i class="fas fa-info-circle"></i> Informations Compl√©mentaires</h2>
        <textarea name="Informations sur le destinataire" placeholder="Nom du destinataire, t√©l√©phone, consignes‚Ä¶" required></textarea>
        <textarea name="Commentaires" placeholder="Commentaire libre (code portail, √©tage, etc.)"></textarea>
      </div>

      <div class="form-section">
        <h2><i class="fas fa-user"></i> Vos Informations</h2>
        <div class="form-grid">
          <input type="text" id="nom" name="Nom du client" placeholder="Nom complet" required>
          <input type="tel" id="tel" name="T√©l√©phone" placeholder="T√©l√©phone" required pattern="^[+]?[0-9]{10,15}$" title="Format : +33612345678 ou 0612345678">
          <div id="tel-error" class="error-message full-width">Num√©ro de t√©l√©phone invalide. Format attendu : 10 √† 15 chiffres, peut commencer par un +.</div>
          <input type="email" id="email" name="Email" placeholder="Adresse email" required class="full-width">
        </div>
        <div class="remember-me full-width">
            <input type="checkbox" id="remember-me">
            <label for="remember-me">Se souvenir de moi pour la prochaine fois</label>
            <button type="button" id="clear-saved-data">Effacer les donn√©es enregistr√©es</button>
        </div>
      </div>

      <div class="summary-section">
        <h2><i class="fas fa-receipt"></i> R√©sum√© & Prix</h2>
        <div id="map"></div>
        <div id="summary">
          <p>Distance : <span id="distance-value">--</span> <span class="spinner" id="distance-spinner"></span></p>
          <div id="distance-error"></div>
          <div id="price-breakdown"></div>
          <p id="price">-- ‚Ç¨</p>
        </div>
      </div>

      <textarea name="R√©sum√© de la commande" id="hidden-summary" style="display:none;"></textarea>

      <button type="submit" id="submit-button" disabled>Veuillez remplir le formulaire</button>
    </form>
  </main>

  <div id="floating-summary" class="floating-summary">
    <div class="floating-summary-content">
      <span>Distance : <span id="floating-distance">--</span></span>
      <span>Total estim√© : <span id="floating-price">-- ‚Ç¨</span></span>
    </div>
  </div>

  <div id="confirmation-modal" class="modal-overlay">
    <div class="modal-content">
        <h2>Confirmer votre commande</h2>
        <div id="modal-summary-content"></div>
        <div class="modal-actions">
            <button type="button" id="edit-order-btn" class="btn-secondary">üìù Modifier</button>
            <button type="button" id="confirm-order-btn">üöÄ Confirmer</button>
        </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
    <script src="scripts/main.js" defer></script>
</body>
</html>